<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - ShopEase</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <style>
    body { min-height: 100vh; display: flex; flex-direction: column; }
    .kpi-card h2 { font-size: 2rem; }
    #footer { margin-top: auto; background: #222; color: #fff; text-align: center; padding: 10px 0; }
    .low-stock { color: red; font-weight: bold; }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">ShopEase</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="dashboard.html">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>
        <li class="nav-item"><a class="nav-link" href="categories.html">Categories</a></li>
        <li class="nav-item"><a class="nav-link text-danger" href="#" data-bs-toggle="modal" data-bs-target="#logoutModal">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- KPI Cards -->
<div class="container mt-4">
  <div class="row text-center">
    <div class="col-md-3 mb-3">
      <div class="card shadow p-3 kpi-card">
        <h4>Total Products</h4>
        <h2 id="totalProducts">0</h2>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card shadow p-3 kpi-card">
        <h4>Total Categories</h4>
        <h2 id="totalCategories">0</h2>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card shadow p-3 kpi-card">
        <h4>Low Stock</h4>
        <h2 id="lowStockCount">0</h2>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card shadow p-3 kpi-card">
        <h4>Out of Stock</h4>
        <h2 id="outStockCount">0</h2>
      </div>
    </div>
  </div>

  <!-- Best Seller -->
  <div class="alert alert-success text-center mt-3">
    ðŸ”¥ Best Seller: <span id="bestSeller">-</span>
  </div>

  <!-- Charts -->
  <div class="row mt-4">
    <div class="col-md-6">
      <h5>Products per Category</h5>
      <canvas id="categoryChart"></canvas>
    </div>
    <div class="col-md-6">
      <h5>Top-Selling Products</h5>
      <canvas id="topSellingChart"></canvas>
    </div>
  </div>

  <!-- Low Stock List -->
  <h5 class="mt-4">Low Stock Items</h5>
  <ul id="lowStockList" class="list-group"></ul>

  <!-- Recent Sales Table -->
  <h5 class="mt-4">Recent Sales</h5>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Product</th>
        <th>Units Sold</th>
        <th>Date</th>
        <th>Total RM</th>
      </tr>
    </thead>
    <tbody id="recentSalesTable"></tbody>
  </table>
</div>

<!-- Logout Modal -->
<div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Logout</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">Are you sure you want to log out?</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmLogoutBtn">Logout</button>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<div id="footer">Â© 2025 ShopEase. All rights reserved.</div>

<script src="js/data.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/script.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    // Dashboard KPIs
    document.getElementById("totalProducts").textContent = products.length;
    document.getElementById("totalCategories").textContent = categories.length;
    const lowStock = products.filter(p => p.stock < 5).length;
    const outStock = products.filter(p => p.stock === 0).length;
    document.getElementById("lowStockCount").textContent = lowStock;
    document.getElementById("outStockCount").textContent = outStock;

    // Best seller
    const best = products.reduce((a,b) => (a.sold > b.sold ? a : b), products[0]);
    document.getElementById("bestSeller").textContent = best.name;

    // Low stock list
    const lowStockList = document.getElementById("lowStockList");
    products.filter(p => p.stock < 5).forEach(p => {
        const li = document.createElement("li");
        li.textContent = `${p.name} - Stock: ${p.stock}`;
        li.classList.add("list-group-item");
        if(p.stock === 0) li.classList.add("low-stock");
        lowStockList.appendChild(li);
    });

    // Recent Sales
    const recentSales = document.getElementById("recentSalesTable");
    sales.forEach(s => {
        const row = recentSales.insertRow();
        row.innerHTML = `<td>${s.product}</td><td>${s.units}</td><td>${s.date}</td><td>${s.total.toFixed(2)}</td>`;
    });

    // Charts
    const ctxBar = document.getElementById("categoryChart");
    new Chart(ctxBar, {
        type: "bar",
        data: {
            labels: categories.map(c => c.name),
            datasets: [{ label: 'Products', data: categories.map(c => c.totalProducts), backgroundColor: "rgba(54, 162, 235, 0.7)" }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
    });

    const ctxTop = document.getElementById("topSellingChart");
    new Chart(ctxTop, {
        type: "bar",
        data: {
            labels: products.map(p => p.name),
            datasets: [{ label: 'Units Sold', data: products.map(p => p.sold), backgroundColor: "rgba(255, 99, 132, 0.7)" }]
        },
        options: { indexAxis: "y", responsive: true, plugins: { legend: { display: false } } }
    });

    // Logout
    const logoutBtn = document.getElementById("confirmLogoutBtn");
    if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
            localStorage.removeItem("loggedIn");
            window.location.href = "index.html";
        });
    }
});
</script>

</body>
</html>
